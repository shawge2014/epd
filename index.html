<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>墨水屏日历</title><link rel="shortcut icon" type="image/png" href="favicon.png"><link rel="stylesheet" href="css/main.css?v=20251109"></head><body><div class="main"><h3>墨水屏日历</h3><fieldset><legend>蓝牙连接</legend><div class="flex-container"><div class="flex-group"><button id="connectbutton" type="button" class="primary" onclick="preConnect()">连接</button><button id="reconnectbutton" type="button" class="secondary" onclick="reConnect()">重连</button><button type="button" class="secondary" onclick="clearLog()">清空日志</button></div><div class="flex-group"><label for="blenamefilter">设备ID:</label><input id="blenamefilter" type="text" value="" placeholder="输入4位16进制" maxlength="4"><button id="filterconnectbutton" type="button" class="primary" onclick="filterConnect()">搜索</button></div></div><div class="flex-container debug driver-row"><div class="flex-group"><label for="epddriver">驱动</label><select id="epddriver" onchange="updateDitcherOptions()"><option value="01" data-color="blackWhiteColor" data-size="4.2_400_300">4.2寸 (黑白, UC8176)</option><option value="03" data-color="threeColor" data-size="4.2_400_300">4.2寸 (三色, UC8176)</option><option value="04" data-color="blackWhiteColor" data-size="4.2_400_300">4.2寸 (黑白, SSD1619)</option><option value="02" data-color="threeColor" data-size="4.2_400_300">4.2寸 (三色, SSD1619)</option><option value="05" data-color="fourColor" data-size="4.2_400_300">4.2寸 (四色, JD79668)</option><option value="0d" data-color="fourColor" data-size="5.83_648_480">5.83寸 (四色, JD79665)</option><option value="06" data-color="blackWhiteColor" data-size="7.5_800_480">7.5寸 (黑白, UC8179)</option><option value="07" data-color="threeColor" data-size="7.5_800_480">7.5寸 (三色, UC8179)</option><option value="0c" data-color="fourColor" data-size="7.5_800_480">7.5寸 (四色, JD79665)</option><option value="08" data-color="blackWhiteColor" data-size="7.5_640_384">7.5寸低分 (黑白, UC8159)</option><option value="09" data-color="threeColor" data-size="7.5_640_384">7.5寸低分 (三色, UC8159)</option><option value="0a" data-color="blackWhiteColor" data-size="7.5_880_528">7.5寸HD (黑白, SSD1677)</option><option value="0b" data-color="threeColor" data-size="7.5_880_528">7.5寸HD (三色, SSD1677)</option></select><label for="epdpins">引脚</label><input id="epdpins" type="text" value=""><button id="setDriverbutton" type="button" class="primary" onclick="setDriver()">确定</button></div></div><div class="log-container" id="log"></div></fieldset><fieldset><legend>设备控制</legend><div class="flex-container"><div class="flex-group"><button id="calendarmodebutton" type="button" class="primary" onclick="syncTime(1)">日历模式</button><button id="clockmodebutton" type="button" class="primary" onclick="syncTime(2)">时钟模式</button><button id="clearscreenbutton" type="button" class="secondary" onclick="clearScreen()">清除屏幕</button></div><div class="flex-group right debug"><input type="text" id="cmdTXT" value=""><button id="sendcmdbutton" type="button" class="primary" onclick="sendcmd()">发送命令</button></div></div><div class="flex-container"><div class="flex-group"><button id="syncholidaybutton" type="button" class="primary" onclick="syncHolidayData()">同步假期数据</button><button id="importholidaybutton" type="button" class="secondary">导入假期JSON</button><input id="holidayJsonFile" type="file" accept="application/json,.json" style="display:none;"><button id="holidayhelpbutton" type="button" class="secondary" onclick="showHolidayHelp()">假期格式说明</button></div></div><div class="flex-container debug"><div class="flex-group"><label for="testTimestamp">测试时间戳:</label><input type="number" id="testTimestamp" placeholder="输入Unix时间戳" style="width: 160px;" oninput="updateTimestampInfo()"><button type="button" class="secondary" onclick="setCurrentTimestamp()">当前时间</button><button type="button" class="secondary" onclick="addDays(1)">+1天</button><button type="button" class="secondary" onclick="addDays(-1)">-1天</button><button type="button" class="primary" onclick="testCalendarJump(1)">日历测试</button><button type="button" class="primary" onclick="testCalendarJump(2)">时钟测试</button></div></div><div class="flex-container debug"><div class="flex-group"><label id="timestampInfo" style="color: #666; font-size: 12px;"></label></div></div><div class="flex-container debug"><div class="flex-group"><label for="testYear">假期测试:</label><input type="number" id="testYear" placeholder="年份" value="2026" min="2007" max="2050" style="width: 80px;"><label for="testMonth">月份:</label><select id="testMonth" style="width: 96px; color: #212529; background-color: white; padding-right: 1.25rem;"><option value="1">1月</option><option value="2">2月</option><option value="3">3月</option><option value="4">4月</option><option value="5">5月</option><option value="6">6月</option><option value="7">7月</option><option value="8">8月</option><option value="9">9月</option><option value="10">10月</option><option value="11">11月</option><option value="12">12月</option></select><button type="button" class="primary" onclick="syncAndShowCalendar()">同步并显示日历</button><label id="holidayTestInfo" style="color: #666; font-size: 12px; margin-left: 10px;"></label></div></div><div class="flex-container debug"><div class="flex-group"><label for="ghostingCycles">残影消除模式:</label><input type="number" id="ghostingCycles" placeholder="执行次数" value="5" min="1" max="1000" style="width: 100px;"><button type="button" class="primary" onclick="startGhostingClearMode()">开始残影消除</button><button type="button" class="secondary" onclick="stopGhostingClearMode()">退出残影消除</button><label id="ghostingInfo" style="color: #666; font-size: 12px; margin-left: 10px;">清除流程: 刷白→等待10s→刷黑→等待10s→刷白并显示次数</label></div></div></fieldset><fieldset><legend>蓝牙传图</legend><div class="flex-container options"><div class="flex-group debug"><label for="canvasSize">画布尺寸:</label><select id="canvasSize" onchange="updateCanvasSize()"><option value="1.54_152_152">1.54 (152x152)</option><option value="1.54_200_200">1.54 (200x200)</option><option value="2.13_212_104">2.13 (212x104)</option><option value="2.13_250_122">2.13 (250x122)</option><option value="2.66_296_152">2.66 (296x152)</option><option value="2.9_296_128">2.9 (296x128)</option><option value="2.9_384_168">2.9 (384x168)</option><option value="3.5_384_184">3.5 (384x184)</option><option value="3.7_416_240">3.7 (416x240)</option><option value="3.97_800_480">3.97 (800x480)</option><option value="4.2_400_300" selected>4.2 (400x300)</option><option value="5.79_792_272">5.79 (792x272)</option><option value="5.83_600_448">5.83 (600x448)</option><option value="5.83_648_480">5.83 (648x480)</option><option value="7.5_640_384">7.5 (640x384)</option><option value="7.5_800_480">7.5 (800x480)</option><option value="7.5_880_528">7.5 (880x528)</option><option value="10.2_960_640">10.2 (960x640)</option><option value="10.85_1360_480">10.85 (1360x480)</option><option value="11.6_960_640">11.6 (960x640)</option><option value="4E_600_400">4E (600x400)</option><option value="7.3E6">7.3E6 (480x800)</option></select></div></div><div class="flex-container options"><div class="flex-group debug"><label for="mtusize">MTU:</label><input type="number" id="mtusize" value="20" min="0" max="255"><label for="interleavedcount">确认间隔:</label><input type="number" id="interleavedcount" value="50" min="0" max="500"></div></div><div class="status-bar"><b>状态：</b><span id="status"></span></div><div class="flex-container"><div class="flex-group"><button type="button" class="secondary debug" onclick="rotateCanvas()">旋转画布</button><button type="button" class="secondary" onclick="clearCanvas()">清除画布</button><button type="button" class="secondary debug" onclick="downloadDataArray()">下载数组</button><button id="sendimgbutton" type="button" class="primary" onclick="sendimg()">发送图片</button></div></div><div class="canvas-container"><div class="canvas-title"></div><canvas id="canvas" width="400" height="300"></canvas><div class="flex-container canvas-tools"><div class="flex-group tool-buttons"><button id="image-mode" title="图片上传" class="tool-button">🖼️</button><button id="brush-mode" title="画笔" class="tool-button">✏️</button><button id="eraser-mode" title="橡皮擦" class="tool-button">🧽</button><button id="text-mode" title="添加文字" class="tool-button">T</button><button id="schedule-mode" title="课表" class="tool-button">📅</button><button id="todo-mode" title="待办事项" class="tool-button">📝</button><button id="wifi-mode" title="WiFi连接" class="tool-button tool-button--wifi" aria-label="WiFi连接"></button><button id="card-mode" title="名片" class="tool-button tool-button--card" aria-label="名片"></button><button id="undo-btn" title="撤销 (Ctrl+Z)" class="tool-button hide">↶</button><button id="redo-btn" title="重做 (Ctrl+Y)" class="tool-button hide">↷</button></div></div><div id="image-panel" style="display:none; width:100%;"><div class="flex-container canvas-tools"><div class="flex-group"><input type="file" id="imageFile" accept=".png,.jpg,.bmp,.webp,.jpeg" onchange="updateImage()"></div></div><div class="flex-container canvas-tools"><div class="flex-group"><label for="ditherMode">颜色模式:</label><select id="ditherMode" onchange="applyDither()"><option value="blackWhiteColor">双色(黑白)</option><option value="threeColor">三色(黑白红)</option><option value="fourColor">四色(黑白红黄)</option><option value="sixColor">六色(黑白红黄蓝绿)</option></select></div><div class="flex-group"><label for="ditherAlg">抖动算法:</label><select id="ditherAlg" onchange="applyDither()"><option value="floydSteinberg">Floyd-Steinberg</option><option value="atkinson">Atkinson</option><option value="bayer">Bayer</option><option value="stucki">Stucki</option><option value="jarvis">Jarvis-Judice-Ninke</option><option value="none">无抖动</option></select></div><div class="flex-group"><label for="ditherStrength">抖动强度:</label><input type="range" min="0" max="5" step="0.1" value="1.0" id="ditherStrength"><label id="ditherStrengthValue">1.0</label></div><div class="flex-group"><label for="ditherContrast">对比度:</label><input type="range" min="0.5" max="2" step="0.1" value="1.2" id="ditherContrast"><label id="ditherContrastValue">1.2</label></div></div><div class="flex-container canvas-tools"><div class="flex-group crop-tools"><button id="crop-zoom-in" title="放大" class="secondary">+</button><button id="crop-zoom-out" title="缩小" class="secondary">-</button><button id="crop-move-left" title="左移">⇦</button><button id="crop-move-up" title="上移">⇧</button><button id="crop-move-down" title="下移">⇩</button><button id="crop-move-right" title="右移">⇨</button><button id="crop-done-btn" title="完成" class="primary">✓</button><button id="crop-cancel-btn" title="取消" class="secondary">✗</button></div></div></div><div class="flex-container canvas-tools"><div class="flex-group brush-tools"><label for="brush-color">颜色:</label><select id="brush-color"><option value="#000000">黑色</option><option value="#FF0000">红色</option><option value="#FFFF00">黄色</option><option value="#00FF00">绿色</option><option value="#0000FF">蓝色</option><option value="#FFFFFF">白色</option></select><label for="brush-size">粗细:</label><input type="number" id="brush-size" value="2" min="1" max="100"></div></div><div class="flex-container canvas-tools"><div class="flex-group text-tools"><label for="font-family">字体:</label><select id="font-family"><option value="Arial">Arial</option><option value="sans-serif">Sans-serif</option><option value="monospace">Monospace</option><option value="SimSun">宋体</option><option value="SimHei">黑体</option><option value="Microsoft Yahei">微软雅黑</option><option value="Microsoft JhengHei">微软正黑体</option><option value="KaiTi">楷体</option><option value="NSimSun">新宋体</option><option value="FangSong">仿宋</option><option value="YouYuan">幼圆</option><option value="LiSu">隶书</option><option value="STHeiti">华文黑体</option><option value="STXihei">华文细黑</option><option value="STKaiti">华文楷体</option><option value="STSong">华文宋体</option><option value="STFangsong">华文仿宋</option><option value="STZhongsong">华文中宋</option><option value="STHupo">华文琥珀</option><option value="STXinwei">华文新魏</option><option value="STLiti">华文隶书</option><option value="STXingkai">华文行楷</option><option value="FZShuTi">方正舒体</option><option value="FZYaoti">方正姚体</option><option value="PingFang SC">苹方</option><option value="Source Han Sans CN">思源黑体</option><option value="Source Han Serif SC">思源宋体</option><option value="WenQuanYi Micro Hei">文泉驿微米黑</option></optgroup></select><label for="font-size">大小:</label><input type="number" id="font-size" value="16" min="1" max="100"></div><div class="flex-group text-tools"><input type="text" id="text-input" placeholder="输入文字" style="width:150px"><button id="text-bold" title="粗体">B</button><button id="text-italic" title="斜体">I</button><button id="add-text-btn" class="primary">添加文字</button></div></div><div id="schedule-panel" style="display:none; width:100%;"><div class="flex-container canvas-tools"><div class="flex-group schedule-tools"><label for="schedule-days">天数:</label><input type="number" id="schedule-days" value="5" min="1" max="7" style="width:60px"><label for="schedule-classes">课程数:</label><input type="number" id="schedule-classes" value="6" min="1" max="12" style="width:60px"><label for="schedule-font-size">字体:</label><select id="schedule-font-size" class="pcf-font-size"><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12" selected>12</option></select><button id="create-schedule-btn" class="primary">初始化课程表</button><button id="schedule-sync-btn" class="primary">课表同步</button><button id="schedule-clear-btn" class="secondary">清空</button></div></div><div class="flex-container canvas-tools"><div class="flex-group schedule-editor" id="schedule-editor" style="display:none; width:100%;"><div class="schedule-editor-hint">提示：在表格里直接输入课程名，点击“课表同步”即可渲染并发送到 EPD。</div><div id="schedule-table-container" class="schedule-table-container"></div></div></div></div><div id="todo-panel" style="display:none; width:100%;"><div class="flex-group todo-tools"><label for="todo-count">待办条数:</label><input type="number" id="todo-count" value="8" min="1" max="30" style="width:70px"><label for="todo-font-size">字体:</label><select id="todo-font-size" class="pcf-font-size"><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12" selected>12</option></select><button id="create-todo-btn" class="primary">初始化待办事项</button><button id="todo-sync-btn" class="primary">待办同步</button><button id="todo-clear-btn" class="secondary">清空</button></div><div class="flex-container canvas-tools"><div class="flex-group todo-editor" id="todo-editor" style="display:none; width:100%;"><div class="todo-editor-hint">提示：在表格里输入待办事项，勾选完成状态，点击“待办同步”即可渲染并发送到。</div><div id="todo-table-container" class="todo-table-container"></div></div></div></div><div id="card-panel" style="display:none; width:100%;"><div class="flex-group card-tools"><label for="card-name">姓名:</label><input type="text" id="card-name" value="张三" style="width:120px"><label for="card-title">职位:</label><input type="text" id="card-title" value="软件工程师" style="width:140px"><label for="card-phone">电话:</label><input type="text" id="card-phone" value="18888888888" style="width:140px"><label for="card-email">邮箱:</label><input type="text" id="card-email" value="john@example.com" style="width:170px"><label for="card-website">网站:</label><input type="text" id="card-website" value="https://johndoe.dev" style="width:190px"><label for="card-footer">底部:</label><input type="text" id="card-footer" value="Empowering Innovation" style="width:220px"><button id="card-sync-btn" class="primary">名片同步</button><button id="card-clear-btn" class="secondary">清空</button></div><div class="flex-container canvas-tools"><div class="flex-group card-editor" id="card-editor" style="width:100%;"><div class="card-editor-hint">提示：点击“名片同步”将按 PCF 点阵字体渲染并发送到 EPD（不做抖动/对比度调整）。</div></div></div></div><div id="wifi-panel" style="display:none; width:100%;"><div class="flex-container canvas-tools"><div class="flex-group wifi-form" id="wifi-form" style="width:100%;"><div class="wifi-field"><label for="wifi-ssid">网络名称 (SSID)</label><input type="text" id="wifi-ssid" placeholder="MyNetwork" /></div><div class="wifi-field"><label for="wifi-password">密码</label><input type="text" id="wifi-password" placeholder="Password123" /></div><div class="wifi-field"><label for="wifi-encryption">加密方式</label><select id="wifi-encryption"><option value="WPA">WPA/WPA2</option><option value="WEP">WEP</option><option value="nopass">无密码</option></select></div><div class="wifi-field"><label><input type="checkbox" id="wifi-hidden" /> 隐藏网络 </label></div><div class="wifi-actions"><button type="button" id="wifi-sync" class="secondary">同步到EPD</button><button type="button" id="wifi-clear" class="secondary">清空</button></div></div></div></div></div></fieldset><div class="footer"><div class="links"><a id="debug-toggle" href="?debug=true">开发模式</a></div></div></div><div id="holidayHelpDialog" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#fafafa; padding:30px; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.3); z-index:1000; max-width:750px; max-height:85vh; overflow-y:auto; font-size:16px; line-height:1.8; color:#212121;"><h3 style="margin-top:0; color:#1a1a1a; border-bottom:3px solid #2196F3; padding-bottom:12px; font-size:22px;">假期数据自动同步说明</h3><div style="margin-bottom:25px;"><h4 style="color:#1976D2; margin-bottom:10px; font-size:18px;">🚀 自动同步功能</h4><div style="background:#e8f5e9; padding:15px; border-radius:6px; border-left:4px solid #4CAF50; font-size:16px;"> 点击<strong style="color:#000;">「同步假期数据」</strong>按钮，系统将自动： <ul style="margin:10px 0 0 20px; line-height:2;"><li>获取当前年份（如：2026年）</li><li>从 holiday-cn 目录加载对应年份的JSON数据</li><li>自动转换为设备格式并发送到EPD设备</li><li>数据保存到NVDS，断电不丢失</li></ul></div></div><div style="margin-bottom:25px;"><h4 style="color:#1976D2; margin-bottom:10px; font-size:18px;">📦 数据来源</h4><div style="background:#fff; padding:15px; border-radius:6px; border:1px solid #e0e0e0; font-size:16px;"> 假期数据来自 <strong style="color:#000;">holiday-cn</strong> 项目<br><a href="https://github.com/NateScarlet/holiday-cn" target="_blank" style="color:#2196F3;">GitHub: NateScarlet/holiday-cn</a><ul style="margin:10px 0 0 20px; line-height:2;"><li>自动抓取国务院公告的官方数据</li><li>每日CI自动更新</li><li>包含节假日和调休安排</li><li>支持2007年至今的所有年份</li></ul></div></div><div style="margin-bottom:25px;"><h4 style="color:#1976D2; margin-bottom:10px; font-size:18px;">📋 JSON数据格式</h4><div style="background:#fff; padding:15px; border-radius:6px; border:1px solid #e0e0e0; font-family:Consolas,Monaco,monospace; font-size:14px; line-height:1.8;"> {<br> &nbsp;&nbsp;"$schema": "https://raw.githubusercontent.com/NateScarlet/holiday-cn/master/schema.json",<br> &nbsp;&nbsp;"$id": "https://raw.githubusercontent.com/NateScarlet/holiday-cn/master/2026.json",<br> &nbsp;&nbsp;"year": 2026,<br> &nbsp;&nbsp;"papers": [<br> &nbsp;&nbsp;&nbsp;&nbsp;"https://www.gov.cn/zhengce/zhengceku/202511/content_7047091.htm"<br> &nbsp;&nbsp;],<br> &nbsp;&nbsp;"days": [<br> &nbsp;&nbsp;&nbsp;&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"name": "元旦",<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"date": "2026-01-01",<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"isOffDay": true <span style="color:#4CAF50;">// true=休息, false=调休上班</span><br> &nbsp;&nbsp;&nbsp;&nbsp;}<br> &nbsp;&nbsp;]<br> } </div><ul style="margin:12px 0 0 20px; line-height:2; font-size:15px;"><li><strong style="color:#000;">$schema</strong>: JSON Schema 地址</li><li><strong style="color:#000;">$id</strong>: 当前年份数据文件地址</li><li><strong style="color:#000;">year</strong>: 年份</li><li><strong style="color:#000;">papers</strong>: 国务院公告来源链接数组</li><li><strong style="color:#000;">days</strong>: 假期/调休日期列表，每项包含 <strong style="color:#000;">name</strong>、<strong style="color:#000;">date</strong>（YYYY-MM-DD）、<strong style="color:#000;">isOffDay</strong></li></ul></div><div style="margin-bottom:25px;"><h4 style="color:#1976D2; margin-bottom:10px; font-size:18px;">⚠️ 注意事项</h4><ul style="line-height:2.2; font-size:16px;"><li>最多支持 <strong style="color:#d32f2f; font-size:17px;">128个</strong> 假期数据</li><li>数据会保存到设备NVDS，<strong style="color:#000;">断电不丢失</strong></li><li>只有与设备当前年份匹配的数据才会在日历上显示</li><li>如果找不到当前年份的JSON文件，同步会失败</li><li>每年需要重新同步一次最新数据</li></ul></div><div style="margin-bottom:25px;"><h4 style="color:#1976D2; margin-bottom:10px; font-size:18px;">🔧 蓝牙指令格式</h4><div style="background:#fff; padding:15px; border-radius:6px; border:1px solid #e0e0e0;"><div style="margin-bottom:10px; font-size:16px;"><strong style="color:#000;">指令:</strong><code style="background:#e3f2fd; padding:4px 8px; border-radius:4px; font-size:15px; color:#0d47a1;">0xB6</code></div><div style="margin-bottom:10px; font-size:16px;"><strong style="color:#000;">数据:</strong> [年份高字节][年份低字节][数量][假期数据...] </div><div style="margin-top:15px; padding:12px; background:#e8f5e9; border-left:4px solid #4CAF50; border-radius:4px;"><strong style="color:#000; font-size:16px;">每个假期2字节编码:</strong><br><div style="margin-top:8px; line-height:2; font-size:15px;"> • Bit 15-12: 工作标志 (0=休, 1=班)<br> • Bit 11-8: 月份 (1-12)<br> • Bit 7-0: 日期 (1-31) </div></div></div></div><div style="margin-bottom:25px;"><h4 style="color:#1976D2; margin-bottom:10px; font-size:18px;">📌 编码示例</h4><div style="background:#fff; padding:15px; border-radius:6px; border:1px solid #e0e0e0; font-family:Consolas,Monaco,monospace; font-size:15px; line-height:2;"> 0x0101 = 1月1日休息<br> 0x1104 = 1月4日调休上班<br> 0x020F = 2月15日休息<br> 0x0A01 = 10月1日休息 </div></div><div style="text-align:right; margin-top:25px; padding-top:18px; border-top:2px solid #e0e0e0;"><button type="button" class="primary" onclick="closeHolidayHelp()" style="padding:10px 30px; font-size:16px;">关闭</button></div></div><div id="holidayHelpOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:999;" onclick="closeHolidayHelp()"></div><script type="text/javascript" src="js/pcfFont.js?v=20260131_4"></script><script type="text/javascript" src="js/qrcode.min.js?v=20260131"></script><script type="text/javascript" src="js/dithering.js?v=20251109"></script><script type="text/javascript" src="js/paint.js?v=20260131_2"></script><script type="text/javascript" src="js/crop.js?v=20251109"></script><script type="text/javascript" src="js/main.js?v=20260131_4"></script></body></html>