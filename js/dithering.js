let rgbPalette=[{name:"黄色",r:255,g:255,b:0,value:226},{name:"绿色",r:41,g:204,b:20,value:150},{name:"蓝色",r:0,g:0,b:255,value:29},{name:"红色",r:255,g:0,b:0,value:76},{name:"黑色",r:0,g:0,b:0,value:0},{name:"白色",r:255,g:255,b:255,value:255}],fourColorPalette=[{name:"黑色",r:0,g:0,b:0,value:0},{name:"白色",r:255,g:255,b:255,value:1},{name:"红色",r:255,g:0,b:0,value:3},{name:"黄色",r:255,g:255,b:0,value:2}],threeColorPalette=[{name:"黑色",r:0,g:0,b:0,value:0},{name:"白色",r:255,g:255,b:255,value:1},{name:"红色",r:255,g:0,b:0,value:2}];function adjustContrast(a,t){var h=a.data;for(let a=0;a<h.length;a+=4)h[a]=Math.min(255,Math.max(0,(h[a]-128)*t+128)),h[a+1]=Math.min(255,Math.max(0,(h[a+1]-128)*t+128)),h[a+2]=Math.min(255,Math.max(0,(h[a+2]-128)*t+128));return a}function rgbToLab(a,t,h){t/=255,h/=255,a=.04045<(a/=255)?Math.pow((a+.055)/1.055,2.4):a/12.92,t=.04045<t?Math.pow((t+.055)/1.055,2.4):t/12.92,h=.04045<h?Math.pow((h+.055)/1.055,2.4):h/12.92;var m=.4124*(a*=100)+.3576*(t*=100)+.1805*(h*=100),r=.2126*a+.7152*t+.0722*h,a=.0193*a+.1192*t+.9505*h,t=(r/=100,a/=108.883,m=.008856<(m/=95.047)?Math.pow(m,1/3):7.787*m+16/116,116*(r=.008856<r?Math.pow(r,1/3):7.787*r+16/116)-16);return{l:t,a:500*(m-r),b:200*(r-(.008856<a?Math.pow(a,1/3):7.787*a+16/116))}}function labDistance(a,t){var h=a.l-t.l,m=a.a-t.a,a=a.b-t.b;return Math.sqrt(.2*h*h+3*m*m+3*a*a)}function findClosestColor(a,t,h,m){let r;if(r="fourColor"===m?fourColorPalette:"threeColor"===m?threeColorPalette:rgbPalette,"fourColor"!==m&&"threeColor"!==m&&a<50&&t<150&&100<h)return rgbPalette[2];if("threeColor"===m)return 120<a&&1.5*t<a&&1.5*h<a?threeColorPalette[2]:.299*a+.587*t+.114*h<128?threeColorPalette[0]:threeColorPalette[1];var M,e=rgbToLab(a,t,h);let n=1/0,i=r[0];for(M of r){var o=labDistance(e,rgbToLab(M.r,M.g,M.b));o<n&&(n=o,i=M)}return i}function floydSteinbergDither(a,h,m){var r=a.width,M=a.height,e=a.data,n=new Uint8ClampedArray(e);for(let t=0;t<M;t++)for(let a=0;a<r;a++){var i=4*(t*r+a),o=n[i],l=n[1+i],x=n[2+i],f=findClosestColor(o,l,x,m),o=(o-f.r)*h,l=(l-f.g)*h,x=(x-f.b)*h;a+1<r&&(n[f=4+i]=Math.min(255,Math.max(0,n[f]+7*o/16)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+7*l/16)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+7*x/16))),t+1<M&&(0<a&&(n[f=i+4*r-4]=Math.min(255,Math.max(0,n[f]+3*o/16)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+3*l/16)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+3*x/16))),n[f=i+4*r]=Math.min(255,Math.max(0,n[f]+5*o/16)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+5*l/16)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+5*x/16)),a+1<r)&&(n[f=i+4*r+4]=Math.min(255,Math.max(0,n[f]+o/16)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+l/16)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+x/16)))}for(let t=0;t<M;t++)for(let a=0;a<r;a++){var u=4*(t*r+a),s=findClosestColor(n[u],n[1+u],n[2+u],m);e[u]=s.r,e[1+u]=s.g,e[2+u]=s.b}return a}function atkinsonDither(a,h,m){var r=a.width,M=a.height,e=a.data,n=new Uint8ClampedArray(e);for(let t=0;t<M;t++)for(let a=0;a<r;a++){var i,o,l,x=4*(t*r+a),f=n[x],u=n[1+x],s=n[2+x],v=findClosestColor(f,u,s,m),f=(e[x]=v.r,e[1+x]=v.g,e[2+x]=v.b,(f-v.r)*h),u=(u-v.g)*h,s=(s-v.b)*h,v=1/8;a+1<r&&(n[i=4+x]=Math.min(255,Math.max(0,n[i]+f*v)),n[1+i]=Math.min(255,Math.max(0,n[1+i]+u*v)),n[2+i]=Math.min(255,Math.max(0,n[2+i]+s*v))),a+2<r&&(n[i=8+x]=Math.min(255,Math.max(0,n[i]+f*v)),n[1+i]=Math.min(255,Math.max(0,n[1+i]+u*v)),n[2+i]=Math.min(255,Math.max(0,n[2+i]+s*v))),t+1<M&&(0<a&&(n[o=x+4*r-4]=Math.min(255,Math.max(0,n[o]+f*v)),n[1+o]=Math.min(255,Math.max(0,n[1+o]+u*v)),n[2+o]=Math.min(255,Math.max(0,n[2+o]+s*v))),n[o=x+4*r]=Math.min(255,Math.max(0,n[o]+f*v)),n[1+o]=Math.min(255,Math.max(0,n[1+o]+u*v)),n[2+o]=Math.min(255,Math.max(0,n[2+o]+s*v)),a+1<r)&&(n[l=x+4*r+4]=Math.min(255,Math.max(0,n[l]+f*v)),n[1+l]=Math.min(255,Math.max(0,n[1+l]+u*v)),n[2+l]=Math.min(255,Math.max(0,n[2+l]+s*v))),t+2<M&&(n[l=x+8*r]=Math.min(255,Math.max(0,n[l]+f*v)),n[1+l]=Math.min(255,Math.max(0,n[1+l]+u*v)),n[2+l]=Math.min(255,Math.max(0,n[2+l]+s*v)))}return a}function stuckiDither(a,h,m){var r=a.width,M=a.height,e=a.data,n=new Uint8ClampedArray(e);for(let t=0;t<M;t++)for(let a=0;a<r;a++){var i=4*(t*r+a),o=n[i],l=n[1+i],x=n[2+i],f=findClosestColor(o,l,x,m),o=(o-f.r)*h,l=(l-f.g)*h,x=(x-f.b)*h;a+1<r&&(n[f=4+i]=Math.min(255,Math.max(0,n[f]+8*o/42)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+8*l/42)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+8*x/42))),a+2<r&&(n[f=8+i]=Math.min(255,Math.max(0,n[f]+4*o/42)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+4*l/42)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+4*x/42))),t+1<M&&(1<a&&(n[f=i+4*r-8]=Math.min(255,Math.max(0,n[f]+2*o/42)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+2*l/42)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+2*x/42))),0<a&&(n[f=i+4*r-4]=Math.min(255,Math.max(0,n[f]+4*o/42)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+4*l/42)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+4*x/42))),n[f=i+4*r]=Math.min(255,Math.max(0,n[f]+8*o/42)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+8*l/42)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+8*x/42)),a+1<r&&(n[f=i+4*r+4]=Math.min(255,Math.max(0,n[f]+4*o/42)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+4*l/42)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+4*x/42))),a+2<r)&&(n[f=i+4*r+8]=Math.min(255,Math.max(0,n[f]+2*o/42)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+2*l/42)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+2*x/42))),t+2<M&&(1<a&&(n[f=i+8*r-8]=Math.min(255,Math.max(0,n[f]+o/42)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+l/42)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+x/42))),0<a&&(n[f=i+8*r-4]=Math.min(255,Math.max(0,n[f]+2*o/42)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+2*l/42)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+2*x/42))),n[f=i+8*r]=Math.min(255,Math.max(0,n[f]+4*o/42)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+4*l/42)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+4*x/42)),a+1<r&&(n[f=i+8*r+4]=Math.min(255,Math.max(0,n[f]+2*o/42)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+2*l/42)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+2*x/42))),a+2<r)&&(n[f=i+8*r+8]=Math.min(255,Math.max(0,n[f]+o/42)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+l/42)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+x/42)))}for(let t=0;t<M;t++)for(let a=0;a<r;a++){var u=4*(t*r+a),s=findClosestColor(n[u],n[1+u],n[2+u],m);e[u]=s.r,e[1+u]=s.g,e[2+u]=s.b}return a}function jarvisDither(a,h,m){var r=a.width,M=a.height,e=a.data,n=new Uint8ClampedArray(e);for(let t=0;t<M;t++)for(let a=0;a<r;a++){var i=4*(t*r+a),o=n[i],l=n[1+i],x=n[2+i],f=findClosestColor(o,l,x,m),o=(e[i]=f.r,e[1+i]=f.g,e[2+i]=f.b,(o-f.r)*h),l=(l-f.g)*h,x=(x-f.b)*h;a+1<r&&(n[f=4+i]=Math.min(255,Math.max(0,n[f]+7*o/48)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+7*l/48)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+7*x/48))),a+2<r&&(n[f=8+i]=Math.min(255,Math.max(0,n[f]+5*o/48)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+5*l/48)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+5*x/48))),t+1<M&&(1<a&&(n[f=i+4*r-8]=Math.min(255,Math.max(0,n[f]+3*o/48)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+3*l/48)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+3*x/48))),0<a&&(n[f=i+4*r-4]=Math.min(255,Math.max(0,n[f]+5*o/48)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+5*l/48)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+5*x/48))),n[f=i+4*r]=Math.min(255,Math.max(0,n[f]+7*o/48)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+7*l/48)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+7*x/48)),a+1<r&&(n[f=i+4*r+4]=Math.min(255,Math.max(0,n[f]+5*o/48)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+5*l/48)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+5*x/48))),a+2<r)&&(n[f=i+4*r+8]=Math.min(255,Math.max(0,n[f]+3*o/48)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+3*l/48)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+3*x/48))),t+2<M&&(1<a&&(n[f=i+8*r-8]=Math.min(255,Math.max(0,n[f]+o/48)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+l/48)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+x/48))),0<a&&(n[f=i+8*r-4]=Math.min(255,Math.max(0,n[f]+3*o/48)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+3*l/48)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+3*x/48))),n[f=i+8*r]=Math.min(255,Math.max(0,n[f]+5*o/48)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+5*l/48)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+5*x/48)),a+1<r&&(n[f=i+8*r+4]=Math.min(255,Math.max(0,n[f]+3*o/48)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+3*l/48)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+3*x/48))),a+2<r)&&(n[f=i+8*r+8]=Math.min(255,Math.max(0,n[f]+o/48)),n[1+f]=Math.min(255,Math.max(0,n[1+f]+l/48)),n[2+f]=Math.min(255,Math.max(0,n[2+f]+x/48)))}return a}function bayerDither(a,h,m){var r=a.width,M=a.height,e=a.data,n=[[0,32,8,40,2,34,10,42],[48,16,56,24,50,18,58,26],[12,44,4,36,14,46,6,38],[60,28,52,20,62,30,54,22],[3,35,11,43,1,33,9,41],[51,19,59,27,49,17,57,25],[15,47,7,39,13,45,5,37],[63,31,55,23,61,29,53,21]];for(let t=0;t<M;t++)for(let a=0;a<r;a++){var i=4*(t*r+a),o=e[i],l=e[1+i],x=e[2+i],f=a%8,f=n[t%8][f]/64*255,l=l+(f-127.5)*h,x=x+(f-127.5)*h,o=findClosestColor(Math.min(255,Math.max(0,o+(f-127.5)*h)),Math.min(255,Math.max(0,l)),Math.min(255,Math.max(0,x)),m);e[i]=o.r,e[1+i]=o.g,e[2+i]=o.b}return a}function ditherImage(a,t,h,m){switch(t){case"floydSteinberg":return floydSteinbergDither(a,h,m);case"atkinson":return atkinsonDither(a,h,m);case"stucki":return stuckiDither(a,h,m);case"jarvis":return jarvisDither(a,h,m);case"bayer":return bayerDither(a,h,m);default:return a}}function decodeProcessedData(m,r,M,a){var t=new ImageData(r,M),e=t.data;if("sixColor"===a)for(let h=0;h<M;h++)for(let a=0;a<r;a++){let t=m[a*M+(M-1-h)];var n=rgbPalette.find(a=>a.value===t)||rgbPalette[5],i=4*(h*r+a);e[i]=n.r,e[1+i]=n.g,e[2+i]=n.b,e[3+i]=255}else if("fourColor"===a){var o=[{value:0,r:0,g:0,b:0},{value:1,r:255,g:255,b:255},{value:3,r:255,g:0,b:0},{value:2,r:255,g:255,b:0}];for(let h=0;h<M;h++)for(let a=0;a<r;a++){var l=(h*r+a)/4|0,x=6-a%4*2;let t=m[l]>>x&3;l=o.find(a=>a.value===t)||o[1],x=4*(h*r+a);e[x]=l.r,e[1+x]=l.g,e[2+x]=l.b,e[3+x]=255}}else if("blackWhiteColor"===a){var h=Math.ceil(r/8);for(let t=0;t<M;t++)for(let a=0;a<r;a++){var f=t*h+Math.floor(a/8),u=7-a%8,f=m[f]>>u&1,u=4*(t*r+a);e[u]=f?255:0,e[1+u]=f?255:0,e[2+u]=f?255:0,e[3+u]=255}}else if("threeColor"===a){var s=Math.ceil(r/8),v=m.slice(0,s*M),b=m.slice(s*M);for(let t=0;t<M;t++)for(let a=0;a<r;a++){var g=t*s+Math.floor(a/8),C=7-a%8,d=v[g]>>C&1,g=b[g]>>C&1,C=4*(t*r+a);g?(e[C]=d?255:0,e[1+C]=d?255:0,e[2+C]=d?255:0):(e[C]=255,e[1+C]=0,e[2+C]=0),e[3+C]=255}}return t}function processImageData(a,h){var m=a.width,r=a.height,M=a.data;let e;if("sixColor"===h){e=new Uint8Array(m*r);for(let t=0;t<r;t++)for(let a=0;a<m;a++){var n=4*(t*m+a),n=findClosestColor(M[n],M[1+n],M[2+n],h),i=a*r+(r-1-t);e[i]=n.value}}else if("fourColor"===h){e=new Uint8Array(Math.ceil(m*r/4));for(let t=0;t<r;t++)for(let a=0;a<m;a++){var o=4*(t*m+a),o=findClosestColor(M[o],M[1+o],M[2+o],h).value,l=(t*m+a)/4|0,x=6-a%4*2;e[l]|=o<<x}}else if("blackWhiteColor"===h){var f=Math.ceil(m/8);e=new Uint8Array(f*r);for(let t=0;t<r;t++)for(let a=0;a<m;a++){var u=4*(t*m+a),s=M[u],v=M[1+u],u=M[2+u],s=140<=Math.round(.299*s+.587*v+.114*u)?1:0,v=t*f+Math.floor(a/8),u=7-a%8;e[v]|=s<<u}}else if("threeColor"===h){var b=Math.ceil(m/8),g=new Uint8Array(r*b),C=new Uint8Array(r*b);for(let t=0;t<r;t++)for(let a=0;a<m;a++){var d=4*(t*m+a),c=M[d],w=M[1+d],d=M[2+d],y=140<=Math.round(.299*c+.587*w+.114*d)?1:0,D=t*b+Math.floor(a/8),P=7-a%8,y=(y?g[D]|=1<<P:g[D]&=~(1<<P),160<c&&w<c&&d<c?0:1),D=t*b+Math.floor(a/8),P=7-a%8;y?C[D]|=1<<P:C[D]&=~(1<<P)}(e=new Uint8Array(g.length+C.length)).set(g,0),e.set(C,g.length)}return e}